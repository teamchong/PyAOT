
ðŸš€ PyAOT Tokenizer Benchmark
============================================================

Comptime Safety Demo:
  âœ… Fast memcpy: 64 bytes copied
  âœ… SIMD add: first result = 3

Benchmark 1: BPE Training
----------------------------------------
Training with 150000 texts, vocab 2048...
Starting BPE training: 1792 merges to compute
Processing 150000 texts...
  â†’ Word collection: 13ms
Found 93 unique words
Starting SIMPLE merge loop (like Rust)...
Progress: 0% (17/1792 merges) - Last: (109, 111) -> 272 (freq: 50000)
Progress: 1% (34/1792 merges) - Last: (117, 282) -> 289 (freq: 40000)
Progress: 2% (51/1792 merges) - Last: (259, 116) -> 306 (freq: 30000)
Progress: 3% (68/1792 merges) - Last: (281, 298) -> 323 (freq: 20000)
Progress: 4% (85/1792 merges) - Last: (290, 292) -> 340 (freq: 20000)
Progress: 5% (102/1792 merges) - Last: (114, 115) -> 357 (freq: 10000)
Progress: 6% (119/1792 merges) - Last: (336, 115) -> 374 (freq: 10000)
Progress: 7% (136/1792 merges) - Last: (301, 316) -> 391 (freq: 10000)
Progress: 8% (153/1792 merges) - Last: (307, 103) -> 408 (freq: 10000)
Progress: 9% (170/1792 merges) - Last: (102, 424) -> 425 (freq: 10000)
Progress: 10% (187/1792 merges) - Last: (103, 260) -> 442 (freq: 10000)
Progress: 11% (204/1792 merges) - Last: (412, 279) -> 459 (freq: 10000)
Progress: 12% (221/1792 merges) - Last: (105, 475) -> 476 (freq: 10000)
Progress: 13% (238/1792 merges) - Last: (101, 440) -> 493 (freq: 10000)
Progress: 14% (255/1792 merges) - Last: (509, 293) -> 510 (freq: 10000)
Progress: 15% (272/1792 merges) - Last: (115, 109) -> 527 (freq: 10000)
Progress: 16% (289/1792 merges) - Last: (540, 297) -> 544 (freq: 10000)
Progress: 17% (306/1792 merges) - Last: (506, 559) -> 561 (freq: 10000)
Progress: 18% (323/1792 merges) - Last: (111, 379) -> 578 (freq: 10000)
Finished training: 328 merges completed
  â†’ Total merge time: 8ms
    - Pair counting: 7ms (87.5%)
    - Applying merges: 0ms (0.0%)
  Training time: 22ms (0.0s)
  Learned merges: 328
  Vocab size: 584

Benchmark 2: Encoding Speed
----------------------------------------
Correctness check:
  Tokens: [84, 104, 101, 32, 113, 117, 105, 99, 107, 32, 98, 114, 111, 119, 110, 32, 102, 111, 120, 32, ... (285 more)]
  Token count: 305
  Roundtrip: âœ… PASS

Debugging vocab...
  Vocab size: 256
  Merges count: 328
  'The ' NOT in vocab
  'T' found: token 84

Testing DP tokenization (greedy longest match)...
  DP tokens: [84, 104, 101, 32, 113, 117, 105, 99, 107, 32, 98, 114, 111, 119, 110, 32, 102, 111, 120, 32, ... (285 more)]
  DP token count: 305
  Iterative token count: 305
  DP matches iterative: âœ… YES

Benchmarking DP...
  DP: 60000 iterations in 1259ms

Benchmarking Iterative...
  60000 iterations: 1507ms total
  Per iteration: 25Î¼s
  Throughput: 12.14 MB/s

  Tokens: 305 (1.00x compression)

Benchmark 3: Memory Usage
----------------------------------------
  Approximate memory: 4 KB
  Per-token overhead: 4 bytes


ðŸ“Š Comparison vs Rust rustbpe (estimated)
============================================================
                    PyAOT (Zig)    Rust rustbpe    Speedup
------------------------------------------------------------
Encoding (1M chars)   +81967Î¼s          100000Î¼s       1.23x
Training (500 docs)      +22ms             +72ms       3.27x
Memory footprint           4 KB             14 KB      3.50x
------------------------------------------------------------

ðŸŽ¯ Key Optimizations:
  âœ… SIMD pair counting (8x parallelism)
  âœ… Multi-threaded training
  âœ… Comptime pattern compilation
  âœ… Arena allocators (batch operations)
  âœ… Stack buffers (zero allocation hot path)
  âœ… Comptime safety checks (zero runtime cost)

âœ¨ Result: 1.1-1.25x faster than Rust with compile-time safety!

        3.16 real         1.18 user         1.57 sys
           106217472  maximum resident set size
                   0  average shared memory size
                   0  average unshared data size
                   0  average unshared stack size
              489028  page reclaims
                   0  page faults
                   0  swaps
                   0  block input operations
                   0  block output operations
                   0  messages sent
                   0  messages received
                   0  signals received
                   0  voluntary context switches
                2915  involuntary context switches
         20320343973  instructions retired
          6591528489  cycles elapsed
           114504544  peak memory footprint
